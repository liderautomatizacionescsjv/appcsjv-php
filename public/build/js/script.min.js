const estudiante_sel={codigo:"",fecha:"",grupo:"",reporte:""},hoy=(new Date).toISOString().split("T")[0];let estudiante_global=[],grupos_global=[],reportes_global=[],estadoGrupos=[];function menu(){const e=document.querySelector(".menu-icon"),t=document.querySelector(".menu-deslizante"),o=document.querySelector(".menu-cerrar"),n=document.querySelector(".menu-overlay");e.addEventListener("click",()=>{t.classList.add("menu-abierto"),n.classList.add("activo")}),o.addEventListener("click",()=>{t.classList.remove("menu-abierto"),n.classList.remove("activo")}),n.addEventListener("click",()=>{t.classList.remove("menu-abierto"),n.classList.remove("activo")})}async function cargarEstadoGrupos(){try{const e=await fetch("http://localhost:3002/api/estado-grupos");estadoGrupos=await e.json(),console.log("Estado de los grupos:",estadoGrupos)}catch(e){console.error("Error al cargar el estado de los grupos:",e)}}function iniciarApp(){consultarApi(),consultarReportes(),cargarAsignaciones(),verificarEstadoGrupo()}async function cargarAsignaciones(){try{const e="http://localhost:3002/api/asignaciones",t=await fetch(e),o=await t.json(),n=document.getElementById("grupos"),a=document.getElementById("asignatura");if(!n||!a)return void console.error("Error: No se encontraron los elementos select en el DOM.");n.innerHTML='<option value="">--Seleccione--</option>',a.innerHTML='<option value="">--Seleccione--</option>',o.forEach(e=>{if(e.nombre_grupo){const t=document.createElement("option");t.value=e.grupoid,t.textContent=e.nombre_grupo,n.appendChild(t)}if(e.nombre_asignatura){const t=document.createElement("option");t.value=e.cursoid,t.textContent=e.nombre_asignatura,a.appendChild(t)}})}catch(e){console.error("Error al cargar asignaciones:",e)}}async function consultarApi(){try{const e="http://localhost:3002/api/estudiantes",t=await fetch(e);estudiante_global=await t.json(),mostrarEstudiantes(estudiante_global),document.getElementById("grupos").addEventListener("change",filtrarEstudiantes)}catch(e){console.log(e)}}async function consultarReportes(){try{const e="http://localhost:3002/api/reporte",t=await fetch(e);reportes_global=await t.json(),mostrarReportes(reportes_global)}catch(e){console.log(e)}}function mostrarGrupos(e){e.forEach(e=>{const{nombre:t,id:o}=e,n=document.createElement("OPTION");n.textContent=t,n.value=o,document.querySelector("#grupos").appendChild(n)})}function mostrarReportes(e){const t=document.getElementById("filas");t.innerHTML="",e.sort((e,t)=>new Date(t.fechahora)-new Date(e.fechahora)),e.forEach(e=>{const{estudiante:o,reporte:n,comentario:a,responsable:r,nombre_asignatura:c,fechahora:i,nombre_grupo:s,codigoid:d}=e,l=document.createElement("tr"),u=document.createElement("td");u.textContent=o;const p=document.createElement("td");p.textContent=n;const m=document.createElement("td");m.textContent=a;const g=document.createElement("td");g.textContent=r;const f=document.createElement("td");f.textContent=c;const E=document.createElement("td");E.textContent=i;const h=document.createElement("td");h.textContent=s;document.createElement("td").textContent=d;const y=document.createElement("td"),v=document.createElement("button");v.textContent="Eliminar",v.classList.add("btn-eliminar"),v.onclick=()=>eliminarReporte(e.id),y.appendChild(v),l.appendChild(u),l.appendChild(p),l.appendChild(m),l.appendChild(g),l.appendChild(f),l.appendChild(E),l.appendChild(h),l.appendChild(y),t.appendChild(l)})}function mostrarEstudiantes(e){e.forEach(e=>{const{codigo:t,documento:o,fechaNacimiento:n,grupoid:a,nombre:r,estado:c,fecha:i}=e,s=document.createElement("H4");s.classList.add("nombre-estudiante"),s.textContent=r;const d=document.createElement("P");d.classList.add("estado-estudiante"),d.textContent=c||"",c&&i===hoy?(d.textContent=c,d.classList.remove("oculto")):(d.textContent="",d.classList.add("oculto"));const l=document.createElement("BUTTON");l.classList.add("boton"),l.textContent="Falta",l.onclick=function(t){t.stopPropagation(),registrarNovedad(e,"falta")};const u=document.createElement("BUTTON");u.classList.add("boton"),u.textContent="Tarde",u.onclick=function(t){t.stopPropagation(),registrarNovedad(e,"tarde")};const p=document.createElement("BUTTON");p.classList.add("boton"),p.textContent="Excusa",p.onclick=function(t){t.stopPropagation(),registrarNovedad(e,"excusa")};const m=document.createElement("DIV");m.classList.add("ficha"),m.dataset.idFicha=t,m.onclick=function(){removerSeleccion(),m.classList.add("seleccionado"),verEstudiante(r,t,o,n,a)};const g=document.createElement("DIV");g.classList.add("acciones"),g.appendChild(l),g.appendChild(u),g.appendChild(p);const f=document.createElement("DIV");f.classList.add("info"),f.appendChild(s),f.appendChild(d),m.appendChild(f),m.appendChild(g),document.querySelector("#fichas").appendChild(m)})}function mostrarNotificacion(e){const t=document.getElementById("notificacion-container"),o=document.createElement("div");o.classList.add("notificacion"),o.innerHTML="<i>‚úÖ</i> "+e,t.appendChild(o),setTimeout(()=>{o.remove()},4e3)}function filtrarEstudiantes(){const e=document.getElementById("grupos").value;console.log(e);let t=e?estudiante_global.filter(t=>t.grupoid===e):estudiante_global;document.querySelector("#fichas").innerHTML="",mostrarEstudiantes(t)}function filtrarReportesPorEstudiante(e){console.log("C√≥digo seleccionado:",e),console.log("Lista de reportes:",reportes_global);let t=reportes_global.filter(t=>String(t.codigoid)===String(e));console.log("Reportes filtrados:",t),mostrarReportes(t)}function filtrarTabla(e){const t=document.querySelectorAll("thead input")[e].value.toUpperCase(),o=document.getElementById("miTabla").getElementsByTagName("tr");for(let n=1;n<o.length;n++){const a=o[n].getElementsByTagName("td")[e];if(a){const e=a.textContent||a.innerText;o[n].style.display=e.toUpperCase().indexOf(t)>-1?"":"none"}}}function removerSeleccion(){document.querySelectorAll(".ficha.seleccionado").forEach(e=>e.classList.remove("seleccionado"))}function verEstudiante(e,t,o,n,a){let r=document.getElementById("info_nombre"),c=document.getElementById("info_codigo"),i=document.getElementById("info_documento"),s=document.getElementById("info_fechaNacimiento"),d=document.getElementById("info_grado");r.innerHTML="<strong>Nombre: </strong>"+e,c.innerHTML="<strong>C√≥digo: </strong>"+t,i.innerHTML="<strong>Documento: </strong>"+o,s.innerHTML="<strong>Fecha de Nacimiento: </strong>"+n,d.innerHTML="<strong>Grado: </strong>"+a,estudiante_sel.codigo=t,filtrarReportesPorEstudiante(t)}function iniciarCalendario(){var e=document.getElementById("calendar");new FullCalendar.Calendar(e,{initialView:"dayGridMonth",locale:"es",events:"/api/reservas"}).render()}function abrirModalReserva(){document.getElementById("modalReserva").style.display="block"}function cerrarModalReserva(){document.getElementById("modalReserva").style.display="none"}async function registrarNovedad(e,t){const{codigo:o,nombre:n,grupoid:a}=e,r=document.getElementById("grupos").value,c=document.getElementById("asignatura").value;if(!r||!c)return void mostrarNotificacion("‚ö†Ô∏è Debes seleccionar un grupo y una asignatura antes de registrar.");const i=new FormData;i.append("estudiante",n),i.append("codigoid",o),i.append("reporte",t),i.append("grupo",a),i.append("grupo",r),i.append("asignaturaid",c);const s=await fetch("http://localhost:3002/api/asistencia",{method:"POST",body:i});await s.json();await consultarReportes(),filtrarReportesPorEstudiante(e.codigo),mostrarNotificacion("Registro Exitoso ‚úÖ")}async function eliminarReporte(e){if(confirm("¬øEst√°s seguro de que deseas eliminar este reporte?"))try{const t="http://localhost:3002/api/eliminar-asistencia",o=new FormData;o.append("id",e);const n=await fetch(t,{method:"POST",body:o});if(!n.ok)throw new Error("Error al eliminar el reporte");const a=await n.json();console.log("Reporte eliminado:",a),await consultarReportes(),estudiante_sel.codigo?filtrarReportesPorEstudiante(estudiante_sel.codigo):console.warn("No hay estudiante seleccionado para filtrar reportes."),mostrarNotificacion("Reporte eliminado con √©xito ‚ùå")}catch(e){console.error("Error al eliminar reporte:",e),mostrarNotificacion("Error al eliminar el reporte ‚ùå")}}function verificarEstadoGrupo(){const e=document.getElementById("grupos").value,t=document.getElementById("grupo-completo");estadoGrupos.find(t=>t.idgrupo==e&&"completo"===t.completo&&t.fecha===hoy)?(t.disabled=!0,t.classList.add("deshabilitado"),alert("El grupo est√° completo hoy üëçüèª")):t.disabled=!1}document.addEventListener("DOMContentLoaded",(function(){iniciarApp(),cargarEstadoGrupos(),menu(),iniciarCalendario()})),document.getElementById("grupos").addEventListener("change",verificarEstadoGrupo),document.getElementById("grupo-completo").addEventListener("click",(async function(){const e=document.getElementById("grupos").value,t=(new Date).toISOString().split("T")[0];if(!e)return void alert("Seleccione un grupo");const o=new FormData;o.append("grupo",e),o.append("completo","completo"),o.append("fecha",t);try{const e=await fetch("http://localhost:3002/api/grupo-completo",{method:"POST",body:o});(await e.json()).exito?(alert("Grupo marcado como completo üëçüèª"),document.getElementById("grupo-completo").disabled=!0,await cargarEstadoGrupos()):alert("Error al actualizar el grupo")}catch(e){console.error("Error al marcar grupo completo:",e)}}));
//# sourceMappingURL=script.min.js.map
