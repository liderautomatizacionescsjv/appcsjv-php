function loadCarros(){const e=document.getElementById("sede").value,t=document.getElementById("carroSelect");t.innerHTML="",e&&fetch("http://localhost:3002/api/carros?sede="+e).then(e=>e.json()).then(e=>{console.log("Datos recibidos de la API:",e),Array.isArray(e)?0!==e.length?e.forEach(e=>{const a=document.createElement("div");a.className="carro-item",a.textContent=`${e.nombre} (${e.totalpc} Computadores)`,a.dataset.carroId=e.id,a.dataset.capacidad=e.totalpc,a.onclick=()=>selectCarro(a),t.appendChild(a)}):t.innerHTML="<p>No hay carros disponibles en esta sede.</p>":console.error("Error: La API no devolvió un array:",e)}).catch(e=>console.error("Error al cargar carros:",e))}function iniciarCalendario(){var e=document.getElementById("calendar");new FullCalendar.Calendar(e,{initialView:"timeGridWeek",nowIndicator:!0,locale:"es",headerToolbar:{left:"prev,next today",center:"title",right:"timeGridWeek,timeGridDay"},slotMinTime:"07:00:00",slotMaxTime:"17:00:00",businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"07:00",endTime:"17:00"},weekends:!1,allDaySlot:!1}).render()}function abrirModalReserva(){document.getElementById("modalReserva").style.display="block"}function cerrarModalReserva(){document.getElementById("modalReserva").style.display="none"}function selectCarro(e){document.querySelectorAll(".carro-item").forEach(e=>e.classList.remove("selected")),e.classList.add("selected");const t=e.dataset.carroId;document.getElementById("abrirModalReservaBtn").disabled=!1,loadCalendar(t)}function loadCalendar(e){fetch("http://localhost:3002/api/reservas?carro_id="+e).then(e=>e.json()).then(e=>{if(console.log("Reservas recibidas para el calendario:",e),!Array.isArray(e))return void console.error("Error: La API no devolvió un array:",e);const t=document.getElementById("calendar");window.calendarInstance&&window.calendarInstance.destroy(),window.calendarInstance=new FullCalendar.Calendar(t,{initialView:"timeGridWeek",nowIndicator:!0,locale:"es",headerToolbar:{left:"prev,next today",center:"title",right:"timeGridWeek,timeGridDay"},slotMinTime:"07:00:00",slotMaxTime:"17:00:00",businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"07:00",endTime:"17:00"},weekends:!1,allDaySlot:!1,events:e,eventClick:function(e){const t=e.event;abrirModalDetalleReserva({carro:t.extendedProps.carro,grupo:t.extendedProps.grupo,responsable:t.extendedProps.responsable,fecha:t.extendedProps.fecha,horaInicio:t.start.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}),horaFin:t.end.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}),cantidadComputadores:t.extendedProps.cantidadComputadores,nombre_carro:t.extendedProps.nombre_carro})},eventColor:"#ffa81d"}),window.calendarInstance.render()}).catch(e=>console.error("Error al cargar reservas en el calendario:",e))}function abrirModalReserva(){const e=document.querySelector(".carro-item.selected");e?(document.getElementById("formReserva").dataset.carroId=e.dataset.carroId,document.getElementById("modalReserva").style.display="block"):alert("Debes seleccionar un carro antes de reservar.")}function limpiarFormularioReserva(){document.getElementById("formReserva").reset(),document.getElementById("fechaReserva").value="",document.getElementById("horaInicio").value="",document.getElementById("horaFin").value="",document.getElementById("cantidadComputadores").value="",document.getElementById("grupo").value="",document.getElementById("disponibilidad").textContent="",console.log("Formulario de reserva reiniciado.")}function abrirModalDetalleReserva(e){console.log("Reserva seleccionada:",e),document.getElementById("detalleCarro").innerText=e.nombre_carro,document.getElementById("detalleGrupo").innerText=e.grupo,document.getElementById("detalleResponsable").innerText=e.responsable,document.getElementById("detalleHoraInicio").innerText=e.horaInicio,document.getElementById("detalleHoraFin").innerText=e.horaFin,document.getElementById("detalleCantidadComputadores").innerText=e.cantidadComputadores,document.getElementById("modalDetalleReserva").style.display="block"}function cerrarModalDetalleReserva(){document.getElementById("modalDetalleReserva").style.display="none"}function verificarDisponibilidad(){const e=document.querySelector(".carro-item.selected"),t=e?e.dataset.carroId:null,a=document.getElementById("fechaReserva").value,r=document.getElementById("horaInicio").value,o=document.getElementById("horaFin").value,n=document.getElementById("disponibilidad"),i=document.getElementById("btn-reservam");if(console.log("Ejecutando verificarDisponibilidad"),console.log("Carro ID:",t),console.log("Fecha:",a),console.log("Hora Inicio:",r),console.log("Hora Fin:",o),!(t&&a&&r&&o))return console.warn("Algunos valores son nulos o no han sido seleccionados."),i.disabled=!0,void(n.textContent="Seleccione una fecha y hora válida.");fetch(`http://localhost:3002/api/disponibilidad?carro_id=${t}&fecha=${a}&horaInicio=${r}&horaFin=${o}`).then(e=>e.json()).then(e=>{if(console.log("Respuesta de API:",e),e.error)return void(n.textContent=e.error);const t=e.computadoresDisponibles;console.log(t),t>0?(n.textContent="Computadores disponibles: "+t,document.getElementById("cantidadComputadores").max=t,i.disabled=!1):(n.textContent="Este carrito no está disponible en este horario",i.disabled=!0)}).catch(e=>{console.error("Error al verificar disponibilidad:",e),reservarBtn.disabled=!0})}function mostrarNotificacion(e){const t=document.getElementById("notificacion-container"),a=document.createElement("div");a.classList.add("notificacion"),a.innerHTML="<i>✅</i> "+e,t.appendChild(a),setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)"},100),setTimeout(()=>{a.style.opacity="0",a.style.transform="translateY(-20px)",setTimeout(()=>{a.remove()},300)},4e3)}async function cargarMisReservas(){try{const e=await fetch("/api/mis-reservas"),t=await e.json(),a=document.getElementById("tabla-reservas");if(a.innerHTML="",t.error)return void(a.innerHTML=`<tr><td colspan="7">${t.error}</td></tr>`);t.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n                <td>${e.nombre_carro}</td>\n                <td>${e.grupo}</td>\n                <td>${e.fecha}</td>\n                <td>${e.horaInicio}</td>\n                <td>${e.horaFin}</td>\n                <td>${e.cantidadComputadores}</td>\n                <td>\n                    <button class="btn-eliminar" onclick="eliminarReserva(${e.id})">Eliminar</button>\n                </td>\n            `,a.appendChild(t)})}catch(e){console.error("Error cargando reservas:",e)}}async function eliminarReserva(e){if(confirm("¿Estás seguro de eliminar esta reserva?"))try{const t=new FormData;t.append("id",e);const a=await fetch("/api/eliminar-reserva",{method:"POST",body:t});(await a.json()).resultado?(alert("Reserva eliminada correctamente"),cargarMisReservas()):alert("Error al eliminar la reserva")}catch(e){console.error("Error al eliminar reserva:",e)}}document.addEventListener("DOMContentLoaded",(function(){cargarMisReservas(),document.getElementById("calendar")&&iniciarCalendario(),document.getElementById("sede")&&document.getElementById("sede").addEventListener("change",loadCarros);const e=document.getElementById("fechaReserva"),t=document.getElementById("horaInicio"),a=document.getElementById("horaFin");if(e){const t=new Date;t.setDate(t.getDate()+1);const a=t.toISOString().split("T")[0];e.setAttribute("min",a)}t&&a&&(t.setAttribute("min","07:00"),t.setAttribute("max","15:00"),a.setAttribute("min","08:00"),a.setAttribute("max","16:00"),t.addEventListener("change",(function(){const e=t.value;if(!e)return;let[r,o]=e.split(":").map(Number);r<7&&(mostrarNotificacion("⚠️ La hora mínima de reserva es 7:00 AM"),t.value="07:00",r=7);let n=r+1;n>16&&(n=16);const i=n.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0");a.value=i,a.setAttribute("min",i)})),a.addEventListener("change",(function(){t.value&&a.value&&(a.value<=t.value&&(mostrarNotificacion("⚠️ La hora de fin debe ser posterior a la hora de inicio."),a.value=""),a.value>"16:00"&&(mostrarNotificacion("⚠️ La hora máxima de reserva es hasta las 4:00 PM."),a.value="16:00"))}))),e&&t&&a?(e.addEventListener("change",verificarDisponibilidad),t.addEventListener("change",verificarDisponibilidad),a.addEventListener("change",verificarDisponibilidad),console.log("Eventos de disponibilidad registrados correctamente")):console.error("Uno o más elementos de fecha y hora no se encontraron en el DOM.")})),document.getElementById("formReserva").addEventListener("submit",(function(e){e.preventDefault();const t=document.querySelector(".carro-item.selected");if(!t)return void alert("Debes seleccionar un carro antes de reservar.");const a={carro:t.dataset.carroId,fecha:document.getElementById("fechaReserva").value,horaInicio:document.getElementById("horaInicio").value,horaFin:document.getElementById("horaFin").value,cantidadComputadores:document.getElementById("cantidadComputadores").value,grupo:document.getElementById("grupo").value};console.log(a),fetch("http://localhost:3002/api/reservas/crear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{"success"===e.status?(mostrarNotificacion("Reserva realizada con éxito ✅"),limpiarFormularioReserva(),cerrarModalReserva(),loadCalendar(t.dataset.carroId)):(alert("Error al reservar: "+e.message),mostrarNotificacion("Error al realizar la reserva ❌"))}).catch(e=>console.error("Error al realizar la reserva:",e))}));
//# sourceMappingURL=reservas.min.js.map
