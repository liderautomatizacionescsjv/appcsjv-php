const estudiante_sel={codigo:"",fecha:"",grupo:"",reporte:""},hoy=(new Date).toISOString().split("T")[0];let estudiante_global=[],grupos_global=[],reportes_global=[],estadoGrupos=[],estudianteActual=null,tipoReporteActual="";async function cargarEstadoGrupos(){try{const e=await fetch("http://localhost:3002/api/estado-grupos");estadoGrupos=await e.json(),console.log("Estado de los grupos:",estadoGrupos)}catch(e){console.error("Error al cargar el estado de los grupos:",e)}}function iniciarApp(){consultarApi(),consultarReportes(),cargarAsignaciones(),verificarEstadoGrupo()}async function cargarAsignaciones(){try{const e="http://localhost:3002/api/asignaciones",t=await fetch(e),o=await t.json(),n=document.getElementById("grupos"),a=document.getElementById("asignatura");if(!n||!a)return void console.error("Error: No se encontraron los elementos select en el DOM.");n.innerHTML='<option value="">--Seleccione--</option>',a.innerHTML='<option value="">--Seleccione--</option>',o.forEach(e=>{if(e.nombre_grupo){const t=document.createElement("option");t.value=e.grupoid,t.textContent=e.nombre_grupo,n.appendChild(t)}if(e.nombre_asignatura){const t=document.createElement("option");t.value=e.cursoid,t.textContent=e.nombre_asignatura,a.appendChild(t)}})}catch(e){console.error("Error al cargar asignaciones:",e)}}async function consultarApi(){try{const e="http://localhost:3002/api/estudiantes",t=await fetch(e);estudiante_global=await t.json(),mostrarEstudiantes(estudiante_global),document.getElementById("grupos").addEventListener("change",filtrarEstudiantes)}catch(e){console.log(e)}}async function consultarReportes(){try{const e="http://localhost:3002/api/reporte",t=await fetch(e);reportes_global=await t.json(),mostrarReportes(reportes_global)}catch(e){console.log(e)}}function mostrarGrupos(e){e.forEach(e=>{const{nombre:t,id:o}=e,n=document.createElement("OPTION");n.textContent=t,n.value=o,document.querySelector("#grupos").appendChild(n)})}function mostrarReportes(e){const t=document.getElementById("filas");t.innerHTML="";const o=document.getElementById("usuario-actual").dataset.nombre||"";e.sort((e,t)=>new Date(t.fechahora)-new Date(e.fechahora)),e.forEach(e=>{const{id:n,estudiante:a,reporte:r,comentario:i,responsable:c,nombre_asignatura:s,fechahora:d,nombre_grupo:l,codigoid:u}=e,m=document.createElement("tr"),p=document.createElement("td");p.textContent=a;const g=document.createElement("td");if(c===o){const e=document.createElement("select");e.innerHTML=`\n                <option value="falta" ${"falta"===r?"selected":""}>Falta</option>\n                <option value="excusa" ${"excusa"===r?"selected":""}>Excusa</option>\n                <option value="tarde" ${"tarde"===r?"selected":""}>Tarde</option>\n            `,e.addEventListener("change",()=>actualizarReporte(n,e.value,i)),g.appendChild(e)}else g.textContent=r;const f=document.createElement("td");if(c===o){const e=document.createElement("textarea");e.value=i,e.rows=2,e.addEventListener("blur",()=>actualizarReporte(n,r,e.value)),f.appendChild(e)}else f.textContent=i;const E=document.createElement("td");E.textContent=c;const h=document.createElement("td");h.textContent=s;const y=document.createElement("td");y.textContent=d;const v=document.createElement("td");v.textContent=l;document.createElement("td").textContent=u;const C=document.createElement("td");if(c===o){const e=document.createElement("button");e.textContent="Eliminar",e.classList.add("btn-eliminar"),e.onclick=()=>eliminarReporte(n),C.appendChild(e)}else C.textContent="üîí";m.appendChild(p),m.appendChild(g),m.appendChild(f),m.appendChild(E),m.appendChild(h),m.appendChild(y),m.appendChild(v),m.appendChild(C),t.appendChild(m)})}function mostrarEstudiantes(e){e.forEach(e=>{const{codigo:t,documento:o,fechaNacimiento:n,nombre_grupo:a,nombre:r,estado:i,fecha:c,email:s}=e,d=document.createElement("H4");d.classList.add("nombre-estudiante"),d.textContent=r;const l=document.createElement("P");function u(t,o,n){const a=document.createElement("BUTTON");a.classList.add("boton-reporte",o),a.textContent=t,a.onclick=function(t){t.stopPropagation(),registrarNovedad(e,n,!1)};const r=document.createElement("SPAN");return r.classList.add("lapiz-icono"),r.innerHTML="‚úèÔ∏è",r.onclick=function(t){t.stopPropagation(),registrarNovedad(e,n,!0)},a.appendChild(r),a}l.classList.add("estado-estudiante"),l.textContent=i||"",i&&c===hoy?l.classList.remove("oculto"):l.classList.add("oculto");const m=u("Falta","btn-falta","falta"),p=u("Tarde","btn-tarde","tarde"),g=u("Excusa","btn-excusa","excusa"),f=document.createElement("DIV");f.classList.add("ficha"),f.dataset.idFicha=t,f.onclick=function(){removerSeleccion(),f.classList.add("seleccionado"),verEstudiante(r,t,o,n,a,s)};const E=document.createElement("DIV");E.classList.add("acciones"),E.appendChild(m),E.appendChild(p),E.appendChild(g);const h=document.createElement("DIV");h.classList.add("info"),h.appendChild(d),h.appendChild(l),f.appendChild(h),f.appendChild(E),document.querySelector("#fichas").appendChild(f)})}function mostrarNotificacion(e){const t=document.getElementById("notificacion-container"),o=document.createElement("div");o.classList.add("notificacion"),o.innerHTML="<i>‚úÖ</i> "+e,t.appendChild(o),setTimeout(()=>{o.remove()},4e3)}function filtrarEstudiantes(){const e=document.getElementById("grupos").value;console.log(e);let t=e?estudiante_global.filter(t=>t.grupoid===e):estudiante_global;document.querySelector("#fichas").innerHTML="",mostrarEstudiantes(t)}function filtrarReportesPorEstudiante(e){console.log("C√≥digo seleccionado:",e),console.log("Lista de reportes:",reportes_global);let t=reportes_global.filter(t=>String(t.codigoid)===String(e));console.log("Reportes filtrados:",t),mostrarReportes(t)}function filtrarTabla(e){const t=document.querySelectorAll("thead input")[e].value.toUpperCase(),o=document.getElementById("miTabla").getElementsByTagName("tr");for(let n=1;n<o.length;n++){const a=o[n].getElementsByTagName("td")[e];if(a){const e=a.textContent||a.innerText;o[n].style.display=e.toUpperCase().indexOf(t)>-1?"":"none"}}}function filtrarEstudiantesPorBusqueda(){const e=document.getElementById("buscador").value.toLowerCase().trim();let t=estudiante_global.filter(t=>{const o=(""+t.nombre).toLowerCase(),n=(""+t.codigo).toLowerCase(),a=(""+t.documento).toLowerCase();return o.includes(e)||n.includes(e)||a.includes(e)});document.querySelector("#fichas").innerHTML="",mostrarEstudiantes(t)}function removerSeleccion(){document.querySelectorAll(".ficha.seleccionado").forEach(e=>e.classList.remove("seleccionado"))}function verEstudiante(e,t,o,n,a,r){let i=document.getElementById("info_nombre"),c=document.getElementById("info_codigo"),s=document.getElementById("info_documento"),d=document.getElementById("info_fechaNacimiento"),l=document.getElementById("info_grado"),u=document.getElementById("info_correo");i.innerHTML="<strong>Nombre: </strong>"+e,c.innerHTML="<strong>C√≥digo: </strong>"+t,s.innerHTML="<strong>Documento: </strong>"+o,d.innerHTML="<strong>Fecha de Nacimiento: </strong>"+n,l.innerHTML="<strong>Grupo: </strong>"+a,u.innerHTML="<strong>Correo: </strong>"+r,estudiante_sel.codigo=t,filtrarReportesPorEstudiante(t)}function iniciarCalendario(){var e=document.getElementById("calendar");new FullCalendar.Calendar(e,{initialView:"dayGridMonth",locale:"es",events:"/api/reservas"}).render()}function abrirModalReserva(){document.getElementById("modalReserva").style.display="block"}function cerrarModalReserva(){document.getElementById("modalReserva").style.display="none"}async function registrarNovedad(e,t,o=!1){estudianteActual=e,tipoReporteActual=t,o?abrirModalComentario(e,t):await enviarNovedad(e,t,"")}async function actualizarReporte(e,t,o){if(!e)return;const n=new FormData;n.append("id",e),n.append("reporte",t),n.append("comentario",o);try{const e=await fetch("http://localhost:3002/api/actualizar-asistencia",{method:"POST",body:n});(await e.json()).exito?mostrarNotificacion("‚úÖ Registro actualizado correctamente"):mostrarNotificacion("‚ö†Ô∏è Error al actualizar el registro.")}catch(e){console.error("Error en la actualizaci√≥n:",e),mostrarNotificacion("‚ö†Ô∏è Error en la actualizaci√≥n.")}}function abrirModalComentario(e,t){estudianteActual=e,tipoReporteActual=t,document.getElementById("comentarioEstudiante").textContent=e.nombre,document.getElementById("comentarioReporte").textContent=t,document.getElementById("comentario").value="",document.getElementById("modalComentario").style.display="block"}function cerrarModalComentario(){document.getElementById("modalComentario").style.display="none"}async function enviarNovedad(e,t,o){if(!e||!t)return void mostrarNotificacion("‚ö†Ô∏è Ocurri√≥ un error al registrar la novedad.");const n=document.getElementById("grupos").value,a=document.getElementById("asignatura").value;if(!n||!a)return void mostrarNotificacion("‚ö†Ô∏è Debes seleccionar un grupo y una asignatura antes de registrar.");const r=new FormData;r.append("estudiante",e.nombre),r.append("codigoid",e.codigo),r.append("reporte",t),r.append("comentario",o),r.append("grupo",n),r.append("asignaturaid",a);try{console.log("üì§ Enviando datos a la API...",Object.fromEntries(r));const t=await fetch("http://localhost:3002/api/asistencia",{method:"POST",body:r}),o=await t.json();console.log("üì• Respuesta de la API:",o),!0===o.resultado?(mostrarNotificacion("‚úÖ Registro exitoso"),console.log("üîÑ Cargando reportes despu√©s del registro..."),await consultarReportes(),filtrarReportesPorEstudiante(e.codigo),verEstudiante(e.nombre,e.codigo,e.documento,e.fechaNacimiento,e.grupoid,e.email)):(console.error("‚ö†Ô∏è Error en la API:",o),mostrarNotificacion("‚ö†Ô∏è Error al registrar la novedad."))}catch(e){console.error("‚ö†Ô∏è Error en fetch:",e),mostrarNotificacion("‚ö†Ô∏è Error al registrar la novedad.")}}async function eliminarReporte(e){if(confirm("¬øEst√°s seguro de que deseas eliminar este reporte?"))try{const t="http://localhost:3002/api/eliminar-asistencia",o=new FormData;o.append("id",e);const n=await fetch(t,{method:"POST",body:o});if(!n.ok)throw new Error("Error al eliminar el reporte");const a=await n.json();console.log("Reporte eliminado:",a),await consultarReportes(),estudiante_sel.codigo?filtrarReportesPorEstudiante(estudiante_sel.codigo):console.warn("No hay estudiante seleccionado para filtrar reportes."),mostrarNotificacion("Reporte eliminado con √©xito ‚ùå")}catch(e){console.error("Error al eliminar reporte:",e),mostrarNotificacion("Error al eliminar el reporte ‚ùå")}}function verificarEstadoGrupo(){const e=document.getElementById("grupos").value,t=document.getElementById("grupo-completo");estadoGrupos.find(t=>t.idgrupo==e&&"completo"===t.completo&&t.fecha===hoy)?(t.disabled=!0,t.classList.add("deshabilitado"),mostrarNotificacion("El grupo est√° completo hoy üëçüèª")):t.disabled=!1}document.addEventListener("DOMContentLoaded",(function(){iniciarApp(),cargarEstadoGrupos();const e=document.getElementById("buscador");e&&e.addEventListener("keyup",filtrarEstudiantesPorBusqueda)})),document.getElementById("ver-todos").addEventListener("click",(function(){const e=document.getElementById("grupos").value;if(!e)return void mostrarNotificacion("‚ö†Ô∏è Debes seleccionar un grupo para ver los registros.");removerSeleccion(),mostrarReportes(reportes_global.filter(t=>String(t.grupo)===String(e)))})),document.getElementById("formComentario").addEventListener("submit",(async function(e){e.preventDefault();const t=document.getElementById("comentario").value.trim();t?(await enviarNovedad(estudianteActual,tipoReporteActual,t),cerrarModalComentario()):mostrarNotificacion("‚ö†Ô∏è Debes escribir un comentario.")})),document.getElementById("grupos").addEventListener("change",verificarEstadoGrupo),document.getElementById("grupo-completo").addEventListener("click",(async function(){const e=document.getElementById("grupos").value,t=(new Date).toISOString().split("T")[0];if(!e)return void mostrarNotificacion("Seleccione un grupo");const o=new FormData;o.append("grupo",e),o.append("completo","completo"),o.append("fecha",t);try{const e=await fetch("http://localhost:3002/api/grupo-completo",{method:"POST",body:o});(await e.json()).exito?(mostrarNotificacion("Grupo marcado como completo üëçüèª"),document.getElementById("grupo-completo").disabled=!0,await cargarEstadoGrupos()):alert("Error al actualizar el grupo")}catch(e){console.error("Error al marcar grupo completo:",e)}}));
//# sourceMappingURL=docentes.min.js.map
